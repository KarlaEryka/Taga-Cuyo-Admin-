    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="https://cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css">
        <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
        <link rel="stylesheet" href="status.css">
        <title>Status</title>
    </head>
    <body>
    <!-- Firebase App (compat version) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>

    <!-- Firebase Firestore SDK (compat version) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <!-- Firebase Auth SDK (compat version) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>


    <!-- SIDEBAR -->
    <section id="sidebar">
        <a href="dashboad.html" class="brand"><img src="images/logo.png" width="70px" height="70px"> TAGA-CUYO</a>
        <ul class="side-menu">
            <li><a href="dashboad.html"><i class='bx bxs-dashboard icon'></i> Admin Dashboard</a></li>
            <li class="divider" data-text="main">Main</li>
            <li>
                <a href="#"><i class='bx bxs-inbox icon'></i> User Management <i class='bx bx-chevron-right icon-right'></i></a>
                <ul class="side-dropdown">
                    <li><a href="user_management_user.html" class="active"><i class='mdi mdi-account icon'></i> List of Users</a></li>
                    <li><a href="user_support.html"><i class='uil uil-users-alt icon'></i> Manage Staff</a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class='bx bxs-graduation icon'></i> Learning Feature Status <i class='bx bx-chevron-right icon-right'></i></a>
                <ul class="side-dropdown">
                    <li><a href="feedback2.html" class="active"><i class='bx bxs-book icon'></i>Aralin Status</a></li>
                    <li><a href="user_support.html"><i class='bx bxs-category icon'></i>Kategorya Status</a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class='bx bxs-comment icon'></i> Support and Feedback <i class='bx bx-chevron-right icon-right'></i></a>
                <ul class="side-dropdown">
                    <li><a href="feedback2.html" class="active"><i class='bx bxs-message-rounded'></i>User Feedback</a></li>
                    <li><a href="user_support.html"><i class='uil uil-headphones-alt'></i>User Support</a></li>
                </ul>
            </li>
            <li><a href="terms_and_condition.html"><i class='bx bxs-file icon'></i> Terms and Condition</a></li>
            <li><a href="settings2.html"><i class='bx bxs-cog icon'></i> Settings</a></li>
        </ul>
    </section>
    <!-- SIDEBAR -->

    <!-- NAVBAR -->
    <section id="content">
        <nav>
        <i class='bx bx-menu toggle-sidebar'></i>
        <form action="#">
            <div class="form-group">
                <input type="text" id="searchInput" placeholder="Search..." onkeyup="searchFeedback()">
                <i class='bx bx-search icon'></i>
            </div>
        </form>
        <div class="profile">
            <div class="notification-icon" onclick="toggleNotificationDropdown()">
                <i class='bx bxs-bell'></i>
                <span id="notificationCounter" class="notification-counter">0</span>
            </div>
            <div id="notificationDropdown" class="notification-dropdown hidden">
                <h4>Notifications</h4>
                <ul id="notificationList">
                    <!-- Notifications will be populated here -->
                </ul>
            </div>
            <img src="images/logo.png" alt="Profile Image">
            <ul class="profile-link">
                <li><a href="/settings2.html"><i class='bx bxs-cog'></i> Settings</a></li>
                <li><a href="login2.html"><i class='bx bxs-log-out-circle'></i> Logout</a></li>
            </ul>
            </div>
        </nav>
    <main>
        <hr class="custom-line">
                <div class="header-search">
                    <h2 style="color: rgb(135, 142, 142);">&nbsp;Learning Feature:Aralin</h2>
                </div>
            </hr>
            &nbsp;
    &nbsp;
    &nbsp;
    &nbsp;
            <!-- Add Content Button -->
    <button id="addContentButton" class="btn btn-primary">Add Content</button>
            <!-- Modal for Adding Content -->
            <div id="addContentModal" class="modal">
                <div class="modal-content">
                    <span class="close-btn">&times;</span>
                    <h2>Add New Content</h2>
                    <form id="addContentForm">
                    <label for="lessonSelect">Select Lesson:</label>
                        <select id="lessonSelect">
                            <option value="" disabled selected>Select a lesson</option>
                            <!-- Dynamic options will be populated here -->
                        </select>
                        <label for="word">Word:</label>
                        <input type="text" id="word" name="word" required>
                        <label for="translated">Translated:</label>
                        <input type="text" id="translated" name="translated" required>
                        <label for="options">Options (comma separated):</label>
                        <input type="text" id="options" name="options">
                        <div class="submit-bb">
                        <button type="submit" class="btn btn-submit">Submit</button>
                    </div>
                    </form>
                </div>
            </div>

            <h4 sty>Pending Aralin</h4>
    <table id="pendingContentTable">
        <thead>
            <tr>
                <th style="text-align: center;">Lesson ID</th>
                <th style="text-align: center;">Lesson Name</th>
                <th style="text-align: center;">Content Details</th>
                <th style="text-align: center;">Requester's Action</th>
                <th style="text-align: center;">Timestamp</th>
                <th style="text-align: center;">Status</th>
                <th style="text-align: center;">Requester</th>
                <th style="text-align: center;">Action</th>
            </tr>
        </thead>
        <tbody id="pendingContentTableBody">
            <!-- Pending content entries will be appended here -->
        </tbody>
    </table>
    &nbsp;
    &nbsp;
    <h4>History of Actions</h4>
    <div style="max-height: 500px; overflow-y: auto; border: 1px;">
        <table id="historyTable" style="width: 100%;">
            <thead style="background-color: rgb(93, 141, 214); text-align: center;">
                <tr>
                    <th style="text-align: center;">Timestamp</th>
                    <th style="text-align: center;">Requester</th>
                    <th style="text-align: center;">Document ID</th>
                    <th style="text-align: center;">Lesson ID</th>
                    <th style="text-align: center;">Content Details</th>
                    <th style="text-align: center;">Requester's Action</th>
                    <th style="text-align: center;">Admin Action</th>
                </tr>
            </thead>
            <tbody id="historyTableBody">
                <!-- History entries will be appended here -->
            </tbody>
        </table>
    </div>


    </main>
    </section>

    <script type="module">
        document.addEventListener("DOMContentLoaded", loadPendingContent);
        document.addEventListener("DOMContentLoaded", loadHistory);

        
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, getDoc, addDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";  // Import authentication module

        const firebaseConfig = {
            apiKey: "AIzaSyA_VoT0W3zD6u5GVEa24dLcMkt3DJtnqYg",
            authDomain: "tagalog-cuyonon-mobile-app.firebaseapp.com",
            projectId: "tagalog-cuyonon-mobile-app",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth();
    onAuthStateChanged(auth, user => {
        if (user) {
            console.log('User is signed in:', user);
            // Proceed with Firestore operations
        } else {
            console.log('No user is signed in.');
        }

    });
    window.approveContent = async function(docId) {
        const docRef = doc(db, 'activities', docId);
        const docSnapshot = await getDoc(docRef);

        if (!docSnapshot.exists()) {
            console.error("No such document! Unable to update.");
            return;
        }

        const data = docSnapshot.data();
        const approveButton = document.querySelector(`button.approve-btn[data-doc-id="${docId}"]`);
        const rejectButton = document.querySelector(`button.reject-btn[data-doc-id="${docId}"]`);

        if (data.location === 'lesson' && data.lessonId) {
            const lessonDocRef = doc(db, 'lessons', data.lessonId);
            const lessonDocSnapshot = await getDoc(lessonDocRef);

            if (lessonDocSnapshot.exists()) {
                const lessonData = lessonDocSnapshot.data();
                const lesson_name = lessonData.lesson_name || 'N/A';
            
                const contentDetails = `Word: ${data.word} <br> Translated: ${data.translated} <br> Options: ${data.options ? data.options.join(', ') : 'No options available'}`;
                const wordsSubcollectionRef = collection(lessonDocRef, 'words');
                await addDoc(wordsSubcollectionRef, {
                    word: data.word,
                    translated: data.translated,
                    options: data.options ? data.options : [],
                    addedBy: data.addedBy,
                    timestamp: new Date(),
                });

                if (lesson_name !== 'N/A') {
                    await updateDoc(lessonDocRef, {
                        lesson_name: lesson_name,
                        isApproved: true,
                        lastUpdated: new Date()
                    });
                }

                await updateDoc(docRef, { isApprove: true });

                // Log the approval action in history
                await addDoc(collection(db, 'history'), {
                    action: 'Added a word in lesson', 
                    addedBy: data.addedBy,
                    lessonId: data.lessonId,
                    documentId: docId,
                    contentDetails:contentDetails,
                    adminAction: 'Added content',
                    timestamp: new Date(),
                });

                // Remove from Pending Content Table
                removeFromPendingContentTable(docId);
                loadHistory();  // Reload history table
            }
        }
    };

    window.rejectContent = async function(docId) {
        const docRef = doc(db, 'activities', docId);
        const docSnapshot = await getDoc(docRef);

        if (docSnapshot.exists()) {
            const data = docSnapshot.data();
            const approveButton = document.querySelector(`button.approve-btn[data-doc-id="${docId}"]`);
            const rejectButton = document.querySelector(`button.reject-btn[data-doc-id="${docId}"]`);
            const contentDetails = `Word: ${data.word} <br> Translated: ${data.translated} <br> Options: ${data.options ? data.options.join(', ') : 'No options available'}`;


            if (data.location === 'lesson' && data.lessonId) {
                const lessonDocRef = doc(db, 'lessons', data.lessonId);
                const lessonDocSnapshot = await getDoc(lessonDocRef);

                if (lessonDocSnapshot.exists()) {
                    const wordsCollectionRef = collection(lessonDocRef, 'words');
                    const wordSnapshot = await getDocs(wordsCollectionRef);

                    wordSnapshot.forEach(async (wordDoc) => {
                        const wordData = wordDoc.data();
                        if (wordData.word === data.word) {
                            await deleteDoc(wordDoc.ref);
                            console.log(`Deleted word: ${data.word}`);
                        }
                    });
                }
            }

            // Delete the activity document
            await deleteDoc(docRef);

            // Log the rejection action in history
            await addDoc(collection(db, 'history'), {
                action: 'Delete word in lessson',
                addedBy: data.addedBy,
                lessonId: data.lessonId,
                documentId: docId,
                contentDetails:contentDetails,
                adminAction: 'Deleted content',
                timestamp: new Date(),
            });

            // Remove from Pending Content Table
            removeFromPendingContentTable(docId);
            loadHistory();  // Reload history table
        }
    };

    window.dismissContent = async function(docId) {
            console.log("Action dismissed. No changes made to the database.");
            const docRef = doc(db, 'activities', docId);
            const docSnapshot = await getDoc(docRef);

            if (!docSnapshot.exists()) {
                console.error("No such document! Unable to dismiss.");
                return;
            }

            const data = docSnapshot.data();
            const contentDetails = `Word: ${data.word} <br> Translated: ${data.translated} <br> Options: ${data.options ? data.options.join(', ') : 'No options available'}`;

            let dismissedContent = JSON.parse(localStorage.getItem('dismissedContent')) || [];
            dismissedContent.push(docId);
            localStorage.setItem('dismissedContent', JSON.stringify(dismissedContent));

            const row = document.querySelector(`tr[data-doc-id="${docId}"]`);
            if (row) {
                alert('It has been dismissed!No changes made!');
                row.remove();
                await addDoc(collection(db, 'history'), {
                    action: 'Request action in lesson',
                    addedBy: data.addedBy,
                    lessonId: data.lessonId,
                    documentId: docId,
                    contentDetails:contentDetails,
                    adminAction: 'Dismissed content',
                    timestamp: new Date(),
                });
            }

            loadHistory();
        };

        function removeFromPendingContentTable(docId) {
            const row = document.querySelector(`tr[data-doc-id="${docId}"]`);
            if (row) {
                row.remove();
            }
        }

        let pendingContentCache = [];
        
    window.editWordContent = async function(docId, documentId) {
        // Prompt to edit word details
        const word = prompt("Enter new word:", "");
        const translated = prompt("Enter new translation:", "");
        const options = prompt("Enter options (comma separated):", "").split(",");

        if (word && translated) {
            const newWordDetails = { word, translated, options };

            const lessonDocRef = doc(db, 'lessons', docId);
            const lessonDocSnapshot = await getDoc(lessonDocRef);

            if (lessonDocSnapshot.exists()) {
                const lessonData = lessonDocSnapshot.data();
                const wordsSubcollectionRef = collection(lessonDocRef, 'words');

                const wordDocRef = doc(wordsSubcollectionRef, docId);
                await updateDoc(wordDocRef, {
                    word: newWordDetails.word,
                    translated: newWordDetails.translated,
                    options: newWordDetails.options || []
                });

                console.log(`Word with ID ${wordId} updated successfully in lesson ${docId}`);

                // Log the action in history
                await addDoc(collection(db, 'history'), {
                    action: 'Edited word in lesson',
                    addedBy: 'admin',
                    lessonId: lessonId,
                    documentId: docId,
                    contentDetails: `Word: ${newWordDetails.word} <br> Translated: ${newWordDetails.translated} <br> Options: ${newWordDetails.options.join(', ')}`,
                    adminAction: 'Updated content',
                    timestamp: new Date(),
                });
            } else {
                console.error('Lesson not found.');
            }
        }
    };

    async function loadPendingContent() {
        const activitiesSnapshot = await getDocs(
            query(
                collection(db, 'activities'),
                orderBy('timestamp', 'desc')
            )
        );

        // Store pending content data in cache
        pendingContentCache = [];
        const tableBody = document.getElementById('pendingContentTableBody');
        tableBody.innerHTML = '';

        const dismissedContent = JSON.parse(localStorage.getItem('dismissedContent')) || [];

        for (const docSnapshot of activitiesSnapshot.docs) {
            const data = docSnapshot.data();
            const docId = docSnapshot.id;

            if (dismissedContent.includes(docId) || data.isApprove) {
                continue;
            }

            let lesson_name = 'N/A';
            if (data.lessonId) {
                const lessonDocRef = doc(db, 'lessons', data.lessonId);
                const lessonDocSnapshot = await getDoc(lessonDocRef);

                if (lessonDocSnapshot.exists()) {
                    lesson_name = lessonDocSnapshot.data().lesson_name || 'N/A';
                }
            }

            const contentDetails = `Word: ${data.word} <br>
                Translated: ${data.translated} <br>
                Options: ${data.options ? data.options.join(', ') : 'No options available'}`;

            // Conditionally display buttons based on the action type
            let actionButtons;
            if (data.action === 'Added word in Lesson') {
                actionButtons = `
                    <button class="approve-btn" data-doc-id="${docId}" onclick="approveContent('${docId}')">Add</button>
                    <button class="dismiss-btn" data-doc-id="${docId}" onclick="dismissContent('${docId}')">Dismiss</button>`;
            } else if (data.action === 'Deleted word from Lesson') {
                actionButtons = `
                    <button class="reject-btn" data-doc-id="${docId}" onclick="rejectContent('${docId}')">Delete</button>
                    <button class="dismiss-btn" data-doc-id="${docId}" onclick="dismissContent('${docId}')">Dismiss</button>`;
            } else {
                console.log("Unknown action:", data.action);
                actionButtons = `<button class="dismiss-btn" data-doc-id="${docId}" onclick="dismissContent('${docId}')">Dismiss</button>`;
            }
            if (data.action === 'Edited word in Lesson') {
            actionButtons = `
            <button class="edit-btn" data-doc-id="${docId}" data-word-id="${data.wordId}" onclick="editWordContent('${docId}', '${data.wordId}')">Edit</button>
            <button class="dismiss-btn" data-doc-id="${docId}" onclick="dismissContent('${docId}')">Dismiss</button>
        
        `;
    }


            const row = document.createElement('tr');
            row.setAttribute('data-doc-id', docId);
            row.innerHTML = `
                <td>${data.lessonId || 'N/A'}</td>
                <td>${lesson_name}</td>
                <td>${contentDetails}</td>
                <td style="text-align: center;">${data.action || 'No action made'}</td>
                <td style="text-align: center;">${data.timestamp.toDate().toLocaleString()}</td>
                <td style="text-align: center;" class="status-pending">Pending</td>
                <td>${data.addedBy}</td>
                <td>${actionButtons}</td>
            `;

            tableBody.appendChild(row);
            pendingContentCache.push({ docId, data });
        }
    }
    async function loadHistory() {
        const historySnapshot = await getDocs(
            query(
                collection(db, 'history'),
                orderBy('timestamp', 'desc')
            )
        );

        const historyTableBody = document.getElementById('historyTableBody');
        historyTableBody.innerHTML = '';

        for (const historyDoc of historySnapshot.docs) {
            const data = historyDoc.data();
            const row = document.createElement('tr');

            // Apply background color based on adminAction
            if (data.adminAction === 'Deleted content') {
                row.style.backgroundColor = 'red'; // For deleted content
            } else if (data.adminAction === 'Approved content') {
                row.style.backgroundColor = 'green'; // For approved content
            } else if (data.adminAction === 'Edited content') {
                row.style.backgroundColor = 'green'; // For edited content
            } else if (data.adminAction === 'Dismissed content') {
                row.style.backgroundColor = 'gray'; // For dismissed content
            }

            row.innerHTML = `
                <td>${data.timestamp.toDate().toLocaleString()}</td>
                <td>${data.addedBy}</td>
                <td>${data.documentId}</td>
                <td>${data.lessonId}</td>
                <td>${data.contentDetails}</td>
                <td>${data.action}</td>
                <td>${data.adminAction}</td>
            `;
            historyTableBody.appendChild(row);
        }
    }

        document.addEventListener("DOMContentLoaded", loadPendingContent);
    // Show and hide modal
document.getElementById('addContentButton').addEventListener('click', () => {
    document.getElementById('addContentModal').style.display = 'block';
});
document.querySelector('.close-btn').addEventListener('click', () => {
    document.getElementById('addContentModal').style.display = 'none';
});

// Handle form submission
document.getElementById('addContentForm').addEventListener('submit', async (event) => {
    event.preventDefault();

    const lessonId = document.getElementById('lessonSelect').value;
    const word = document.getElementById('word').value.trim();
    const translated = document.getElementById('translated').value.trim();
    const options = document.getElementById('options').value.split(',').map(opt => opt.trim());

    if (!lessonId || !word || !translated) {
        alert("Please fill out all required fields.");
        return;
    }

    // Reference to selected lesson in Firestore
    const lessonDocRef = doc(db, 'lessons', lessonId);
    const wordsSubcollectionRef = collection(lessonDocRef, 'words');

    try {
        // Add new content to the selected lesson
        await addDoc(wordsSubcollectionRef, {
            word,
            translated,
            options,
            addedBy: auth.currentUser ? auth.currentUser.email : "unknown",
            timestamp: new Date()
        });

        // Optional: Update lesson metadata if needed
        await updateDoc(lessonDocRef, { lastUpdated: new Date() });
        
        // Hide modal and reset form
        document.getElementById('addContentModal').style.display = 'none';
        document.getElementById('addContentForm').reset();
        alert("Content added successfully!");

        await addDoc(collection(db, "history"), {
        action: 'Added content to lesson',
        addedBy: auth.currentUser ? auth.currentUser.email : "unknown",
        lessonId: lessonId,
        documentId: contentDoc.id,
        contentDetails: `Word: ${word}, Translated: ${translated}, Options: ${options.join(', ') || 'None'}`,
        adminAction: 'Content added',
        timestamp: new Date()
    });

        // Reload pending content table (if applicable)
        loadPendingContent();

    } catch (error) {
        console.error("Error adding content:", error);
        alert("Failed to add content. Please try again.");
    }
});

        async function populateLessonDropdown() {
        const lessonsRef = collection(db, 'lessons');
        const lessonsSnapshot = await getDocs(lessonsRef);

        const lessonSelect = document.getElementById('lessonSelect');
        lessonSelect.innerHTML = `<option value="" disabled selected>Select a lesson</option>`;  // Reset dropdown

        lessonsSnapshot.forEach((doc) => {
            const lessonData = doc.data();
            const option = document.createElement('option');
            option.value = doc.id;  // lessonId
            option.textContent = `${doc.id} - ${lessonData.lesson_name}`;  // Display lessonId and lesson_name
            lessonSelect.appendChild(option);
        });
    }
    document.addEventListener("DOMContentLoaded", () => {
        populateLessonDropdown();  // Populate dropdown when the page is ready
    });
    
    </script>
    <script src="script.js"></script>
    <script src="trynotif.js"></script>
    </body>
    </html>
